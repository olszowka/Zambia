TITLE='Conflict Report - Scheduled Programming sessions without enough people'
DESCRIPTION='This report runs against scheduled sessions in division program only.   If these are panels, you need at least 3 people.  All other types require at least 1.'
CONFLICTWANTS=1
QUERY="
  select T.trackname, 
         Y.typename,
         concat('<a href=StaffAssignParticipants.php?selsess=',S.sessionid,'>', 
                S.sessionid,'</a>') as Sessionid, 
         concat('<a href=EditSession.php?id=',S.sessionid,'>',S.title,'</a>') Title,
         if(X.assigned is NULL, 0, X.assigned) assigned,
         concat('<a href=MaintainRoomSched.php?selroom=',R.roomid,'>', 
                 R.roomname,'</a>') as Roomname
  from   Sessions  S
         left join (  select S1.sessionid, count(badgeid) assigned 
                        from Sessions S1 ,
                             ParticipantOnSession POS 
                       where S1.sessionid=POS.sessionid
                       group by S1.sessionid ) X
                on S.sessionid=X.sessionid,
         Schedule SCH,
         Tracks T,
         Types Y,
         Divisions D,
         Rooms R
   where S.sessionid=SCH.sessionid
     and S.trackid=T.trackid 
     and S.typeid=Y.typeid
     and S.divisionid=D.divisionid
     and SCH.roomid=R.roomid
     and S.statusid=3  
     and D.divisionname='Programming'
     and ((Y.typename = 'Panel' and assigned<3)
          or (Y.typename != 'Panel'  and assigned<1)
          or assigned is NULL)
order by T.trackname, S.sessionid;"

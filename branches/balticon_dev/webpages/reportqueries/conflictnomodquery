TITLE='Conflict Report - Sessions with no moderator'
DESCRIPTION='Panels need a moderator.  Events may not.  Think before you jump.  (This is limited to items in the schedule which have at least one participant.)'
CONFLICTWANTS=1
QUERY="
SELECT
            concat('<a href=StaffAssignParticipants.php?selsess=',S.sessionid,'>', S.sessionid,'</a>') as Sessionid,
            T.trackname,
            TY.typename,
            S.title
    FROM
            Sessions S
       JOIN Schedule SCH USING(sessionid)
       JOIN Tracks T USING(trackid)
       JOIN Types TY USING(typeid)
  LEFT JOIN (SELECT
                    sessionid,                
                    count(*) as parts,
                    sum(if(moderator=1,1,0)) as mods
               FROM ParticipantOnSession
           GROUP BY sessionid) X
                 USING (sessionid)
WHERE
            X.parts>0 AND
            X.mods=0
   ORDER BY T.trackname, S.sessionid"


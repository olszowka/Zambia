(function(b){var a=null;b.fn.extend({searchGrid:function(c){c=b.extend({top:0,left:0,width:360,height:80,modal:false,drag:true,closeicon:"ico-close.gif",dirty:false,sField:"searchField",sValue:"searchString",sOper:"searchOper",processData:"",checkInput:false,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeOnEscape:false,sopt:null},b.jgrid.search,c||{});return this.each(function(){var n=this;if(!n.grid){return}if(!c.imgpath){c.imgpath=n.p.imgpath}var d=b("table:first",n.grid.bDiv).attr("id");var j={themodal:"srchmod"+d,modalhead:"srchhead"+d,modalcontent:"srchcnt"+d};if(b("#"+j.themodal).html()!=null){if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#srchcnt"+d))}viewModal("#"+j.themodal,{modal:c.modal});if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#srchcnt"+d))}}else{var h=n.p.colModel;var s="<select id='snames' class='search'>";var t,o,p;for(var m=0;m<h.length;m++){t=h[m].name;p=(h[m].search===false)?false:true;if(h[m].editrules&&h[m].editrules.searchhidden===true){o=true}else{if(h[m].hidden===true){o=false}else{o=true}}if(t!=="cb"&&t!=="subgrid"&&p&&o===true){var e=(h[m].index)?h[m].index:t;s+="<option value='"+e+"'>"+n.p.colNames[m]+"</option>"}}s+="</select>";var q=c.sopt||["bw","eq","ne","lt","le","gt","ge","ew","cn"];var f="<select id='sopt' class='search'>";for(var m=0;m<q.length;m++){f+=q[m]=="eq"?"<option value='eq'>"+c.odata[0]+"</option>":"";f+=q[m]=="ne"?"<option value='ne'>"+c.odata[1]+"</option>":"";f+=q[m]=="lt"?"<option value='lt'>"+c.odata[2]+"</option>":"";f+=q[m]=="le"?"<option value='le'>"+c.odata[3]+"</option>":"";f+=q[m]=="gt"?"<option value='gt'>"+c.odata[4]+"</option>":"";f+=q[m]=="ge"?"<option value='ge'>"+c.odata[5]+"</option>":"";f+=q[m]=="bw"?"<option value='bw'>"+c.odata[6]+"</option>":"";f+=q[m]=="ew"?"<option value='ew'>"+c.odata[7]+"</option>":"";f+=q[m]=="cn"?"<option value='cn'>"+c.odata[8]+"</option>":""}f+="</select>";var r="<input id='sval' class='search' type='text' size='20' maxlength='100'/>";var k="<input id='sbut' class='buttonsearch' type='button' value='"+c.Find+"'/>";var l="<input id='sreset' class='buttonsearch' type='button' value='"+c.Reset+"'/>";var g=b("<table width='100%'><tbody><tr style='display:none' id='srcherr'><td colspan='5'></td></tr><tr><td>"+s+"</td><td>"+f+"</td><td>"+r+"</td><td>"+k+"</td><td>"+l+"</td></tr></tbody></table>");createModal(j,g,c,n.grid.hDiv,n.grid.hDiv);if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#srchcnt"+d))}if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#srchcnt"+d))}viewModal("#"+j.themodal,{modal:c.modal});if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#srchcnt"+d))}if(c.drag){DnRModal("#"+j.themodal,"#"+j.modalhead+" td.modaltext")}b("#sbut","#"+j.themodal).click(function(){if(b("#sval","#"+j.themodal).val()!=""){var w=[true,"",""];b("#srcherr >td","#srchcnt"+d).html("").hide();n.p.searchdata[c.sField]=b("option[selected]","#snames").val();n.p.searchdata[c.sOper]=b("option[selected]","#sopt").val();n.p.searchdata[c.sValue]=b("#sval","#"+j.modalcontent).val();if(c.checkInput){for(var v=0;v<h.length;v++){var u=(h[v].index)?h[v].index:t;if(u==n.p.searchdata[c.sField]){break}}w=checkValues(n.p.searchdata[c.sValue],v,n)}if(w[0]===true){n.p.search=true;if(c.dirty){b(".no-dirty-cell",n.p.pager).addClass("dirty-cell")}n.p.page=1;b(n).trigger("reloadGrid");if(c.closeAfterSearch===true){hideModal("#"+j.themodal)}}else{b("#srcherr >td","#srchcnt"+d).html(w[1]).show()}}});b("#sreset","#"+j.themodal).click(function(){if(n.p.search){b("#srcherr >td","#srchcnt"+d).html("").hide();n.p.search=false;n.p.searchdata={};n.p.page=1;b("#sval","#"+j.themodal).val("");if(c.dirty){b(".no-dirty-cell",n.p.pager).removeClass("dirty-cell")}b(n).trigger("reloadGrid")}})}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:0,modal:false,drag:true,closeicon:"ico-close.gif",imgpath:"",url:null,mtype:"POST",closeAfterAdd:false,clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,closeOnEscape:false,addedrow:"first"},b.jgrid.edit,d||{});a=d;return this.each(function(){var x=this;if(!x.grid||!c){return}if(!d.imgpath){d.imgpath=x.p.imgpath}var p=b("table:first",x.grid.bDiv).attr("id"),h={themodal:"editmod"+p,modalhead:"edithd"+p,modalcontent:"editcnt"+p},D=b.isFunction(a.beforeShowForm)?a.beforeShowForm:false,n=b.isFunction(a.afterShowForm)?a.afterShowForm:false,z=b.isFunction(a.beforeInitData)?a.beforeInitData:false,u=b.isFunction(a.onInitializeForm)?a.onInitializeForm:false,f=1,i,A="FrmGrid_"+p,r="TblGrid_"+p;if(c=="new"){c="_empty";d.caption=d.addCaption}else{d.caption=d.editCaption}if(d.recreateForm===true&&b("#"+h.themodal).html()!=null){b("#"+h.themodal).remove()}if(b("#"+h.themodal).html()!=null){b(".modaltext","#"+h.modalhead).html(d.caption);b("#FormError","#"+r).hide();if(z){z(b("#"+A))}k(c,x);if(c=="_empty"){b("#pData, #nData","#"+r).hide()}else{b("#pData, #nData","#"+r).show()}if(D){D(b("#"+A))}if(d.processing===true){d.processing=false;b("#sData","#"+r).attr("disabled",false);b("div.loading","#"+h.themodal).hide()}viewModal("#"+h.themodal,{modal:d.modal});if(n){n(b("#"+A))}}else{b(x.p.colModel).each(function(E){f=Math.max(f,this.formoptions?this.formoptions.colpos||0:0)});var w,B=b("<form name='FormPost' id='"+A+"' class='FormGrid'></form>"),j=b("<table id='"+r+"' class='EditTable' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");b(B).append(j);w=b("<tr id='FormError' style='display:none'><td colspan='"+(f*2)+"'></td></tr>");w[0].rp=0;b(j).append(w);if(z){z(b("#"+A))}var v=l(c,x,j,f),y=x.p.imgpath,s="<img id='pData' src='"+y+x.p.previmg+"'/>",t="<img id='nData' src='"+y+x.p.nextimg+"'/>",q="<input id='sData' type='button' class='EditButton' value='"+d.bSubmit+"'/>",C="<input id='cData' type='button'  class='EditButton' value='"+d.bCancel+"'/>";w=b("<tr id='Act_Buttons'><td class='navButton'>"+s+"&nbsp;"+t+"</td><td colspan='"+(f*2-1)+"'class='EditButton'>"+q+"&nbsp;"+C+"</td></tr>");w[0].rp=v.length+100;b(j).append(w);if(f>1){var e=[];b.each(b(j)[0].rows,function(E,F){e[E]=F});e.sort(function(F,E){if(F.rp>E.rp){return 1}if(F.rp<E.rp){return -1}return 0});b.each(e,function(E,F){b("tbody",j).append(F)})}createModal(h,B,d,x.grid.hDiv,x.grid.hDiv);if(u){u(b("#"+A))}if(d.drag){DnRModal("#"+h.themodal,"#"+h.modalhead+" td.modaltext")}if(c=="_empty"){b("#pData,#nData","#"+r).hide()}else{b("#pData,#nData","#"+r).show()}if(D){D(b("#"+A))}viewModal("#"+h.themodal,{modal:d.modal});if(n){n(b("#"+A))}b("#sData","#"+r).click(function(I){var H={},G=[true,"",""],J={};b("#FormError","#"+r).hide();var F=0;b(".FormElement","#"+r).each(function(M){var L=true;switch(b(this).get(0).type){case"checkbox":if(b(this).attr("checked")){H[this.name]=b(this).val()}else{var K=b(this).attr("offval");H[this.name]=K;J[this.name]=K}break;case"select-one":H[this.name]=b("option:selected",this).val();J[this.name]=b("option:selected",this).text();break;case"select-multiple":H[this.name]=b(this).val();var N=[];b("option:selected",this).each(function(O,P){N[O]=b(P).text()});J[this.name]=N.join(",");break;case"password":case"text":case"textarea":H[this.name]=b(this).val();G=checkValues(H[this.name],v[M],x);if(G[0]===false){L=false}else{H[this.name]=!x.p.autoencode?H[this.name]:htmlEncode(H[this.name])}break}F++;if(!L){return false}});if(F==0){G[0]=false;G[1]=b.jgrid.errors.norecords}if(b.isFunction(a.onclickSubmit)){a.editData=a.onclickSubmit(d)||{}}if(G[0]){if(b.isFunction(a.beforeSubmit)){G=a.beforeSubmit(H,b("#"+A))}}var E=a.url?a.url:x.p.editurl;if(G[0]){if(!E){G[0]=false;G[1]+=" "+b.jgrid.errors.nourl}}if(G[0]===false){b("#FormError>td","#"+r).html(G[1]);b("#FormError","#"+r).show()}else{if(!d.processing){d.processing=true;b("div.loading","#"+h.themodal).show();b(this).attr("disabled",true);H.oper=H.id=="_empty"?"add":"edit";H=b.extend(H,a.editData);b.ajax({url:E,type:a.mtype,data:H,complete:function(L,K){if(K!="success"){G[0]=false;G[1]=K+" Status: "+L.statusText+" Error code: "+L.status}else{if(b.isFunction(a.afterSubmit)){G=a.afterSubmit(L,H)}}if(G[0]===false){b("#FormError>td","#"+r).html(G[1]);b("#FormError","#"+r).show()}else{H=b.extend(H,J);if(H.id=="_empty"){if(!G[2]){G[2]=parseInt(b(x).getGridParam("records"))+1}H.id=G[2];if(a.closeAfterAdd){if(a.reloadAfterSubmit){b(x).trigger("reloadGrid")}else{b(x).addRowData(G[2],H,d.addedrow);b(x).setSelection(G[2])}hideModal("#"+h.themodal)}else{if(a.clearAfterAdd){if(a.reloadAfterSubmit){b(x).trigger("reloadGrid")}else{b(x).addRowData(G[2],H,d.addedrow)}b(".FormElement","#"+r).each(function(M){switch(b(this).get(0).type){case"checkbox":b(this).attr("checked",0);break;case"select-one":case"select-multiple":b("option",this).attr("selected","");break;case"password":case"text":case"textarea":if(this.name=="id"){b(this).val("_empty")}else{b(this).val("")}break}});k("_empty",x)}else{if(a.reloadAfterSubmit){b(x).trigger("reloadGrid")}else{b(x).addRowData(G[2],H,d.addedrow)}}}}else{if(a.reloadAfterSubmit){b(x).trigger("reloadGrid");if(!a.closeAfterEdit){b(x).setSelection(H.id)}}else{if(x.p.treeGrid===true){b(x).setTreeRow(H.id,H)}else{b(x).setRowData(H.id,H)}}if(a.closeAfterEdit){hideModal("#"+h.themodal)}}if(b.isFunction(a.afterComplete)){i=L;setTimeout(function(){a.afterComplete(i,H,b("#"+A));i=null},500)}}d.processing=false;b("#sData","#"+r).attr("disabled",false);b("div.loading","#"+h.themodal).hide()},error:function(M,K,L){b("#FormError>td","#"+r).html(K+" : "+L);b("#FormError","#"+r).show();d.processing=false;b("#sData","#"+r).attr("disabled",false);b("div.loading","#"+h.themodal).hide()}})}}I.stopPropagation();return false});b("#cData","#"+r).click(function(E){hideModal("#"+h.themodal);E.stopPropagation();return false});b("#nData","#"+r).click(function(E){b("#FormError","#"+r).hide();var F=g();F[0]=parseInt(F[0]);if(F[0]!=-1&&F[1][F[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+A),F[1][F[0]])}k(F[1][F[0]+1],x);b(x).setSelection(F[1][F[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+A),F[1][F[0]+1])}m(F[0]+1,F[1].length-1)}return false});b("#pData","#"+r).click(function(F){b("#FormError","#"+r).hide();var E=g();if(E[0]!=-1&&E[1][E[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+A),E[1][E[0]])}k(E[1][E[0]-1],x);b(x).setSelection(E[1][E[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+A),E[1][E[0]-1])}m(E[0]-1,E[1].length-1)}return false})}var o=g();m(o[0],o[1].length-1);function m(G,H,F){var E=x.p.imgpath;if(G==0){b("#pData","#"+r).attr("src",E+"off-"+x.p.previmg)}else{b("#pData","#"+r).attr("src",E+x.p.previmg)}if(G==H){b("#nData","#"+r).attr("src",E+"off-"+x.p.nextimg)}else{b("#nData","#"+r).attr("src",E+x.p.nextimg)}}function g(){var F=b(x).getDataIDs();var E=b("#id_g","#"+r).val();var G=b.inArray(E,F);return[G,F]}function l(H,M,K,R){var F,G,O,U,E,P=0,T,V,N,S=[],L=false,I="<td class='CaptionTD'>&nbsp;</td><td class='DataTD'>&nbsp;</td>",J="";for(var Q=1;Q<=R;Q++){J+=I}L=b(M).getInd(M.rows,H);b(M.p.colModel).each(function(Z){F=this.name;if(this.editrules&&this.editrules.edithidden==true){G=false}else{G=this.hidden===true?true:false}V=G?"style='display:none'":"";if(F!=="cb"&&F!=="subgrid"&&this.editable===true){if(L===false){T=""}else{if(F==M.p.ExpandColumn&&M.p.treeGrid===true){T=b("td:eq("+Z+")",M.rows[L]).text()}else{try{T=b.unformat(b("td:eq("+Z+")",M.rows[L]),{colModel:this},Z)}catch(X){T=b("td:eq("+Z+")",M.rows[L]).html()}}}var Y=b.extend({},this.editoptions||{},{id:F,name:F}),ac=b.extend({},{elmprefix:"",elmsuffix:""},this.formoptions||{}),aa=parseInt(ac.rowpos)||P+1,ab=parseInt((parseInt(ac.colpos)||1)*2);if(H=="_empty"&&Y.defaultValue){T=b.isFunction(Y.defaultValue)?Y.defaultValue():Y.defaultValue}if(!this.edittype){this.edittype="text"}N=createEl(this.edittype,Y,T);b(N).addClass("FormElement");O=b(j).find("tr[rowpos="+aa+"]");if(O.length==0){O=b("<tr "+V+" rowpos='"+aa+"'></tr>").addClass("FormData").attr("id","tr_"+F);b(O).append(J);b(K).append(O);O[0].rp=aa}b("td:eq("+(ab-2)+")",O[0]).html(typeof ac.label==="undefined"?M.p.colNames[Z]:ac.label);b("td:eq("+(ab-1)+")",O[0]).append(ac.elmprefix).append(N).append(ac.elmsuffix);S[P]=Z;P++}});if(P>0){var W=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(R*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+H+"'/></td></tr>");W[0].rp=P+99;b(K).append(W)}return S}function k(I,J){var E,K,H=0,G,F;b("#"+I+" td",J.grid.bDiv).each(function(M){E=J.p.colModel[M].name;if(J.p.colModel[M].editrules&&J.p.colModel[M].editrules.edithidden===true){K=false}else{K=J.p.colModel[M].hidden===true?true:false}if(E!=="cb"&&E!=="subgrid"&&J.p.colModel[M].editable===true){if(E==J.p.ExpandColumn&&J.p.treeGrid===true){G=b(this).text()}else{try{G=b.unformat(this,{colModel:J.p.colModel[M]},M)}catch(L){G=b(this).html()}}E=E.replace(".","\\.");F=b.extend({},J.p.colModel[M].editoptions||{});if(I=="_empty"&&F.defaultValue){G=b.isFunction(F.defaultValue)?F.defaultValue():F.defaultValue}switch(J.p.colModel[M].edittype){case"password":case"text":b("#"+E,"#"+r).val(G);break;case"textarea":if(G=="&nbsp;"||G=="&#160;"||(G.length==1&&G.charCodeAt(0)==160)){G=""}b("#"+E,"#"+r).val(G);break;case"select":b("#"+E+" option","#"+r).each(function(N){if(!F.multiple&&G==b(this).text()){this.selected=true}else{if(F.multiple){if(b.inArray(b(this).text(),G.split(","))>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":if(G==b("#"+E,"#"+r).val()){b("#"+E,"#"+r).attr("checked",true);b("#"+E,"#"+r).attr("defaultChecked",true)}else{b("#"+E,"#"+r).attr("checked",false);b("#"+E,"#"+r).attr("defaultChecked","")}break}if(K){b("#"+E,"#"+r).parents("tr:first").hide()}H++}});if(H>0){b("#id_g","#"+r).val(I)}else{b("#id_g","#"+r).val("")}return H}})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:0,modal:false,drag:true,closeicon:"ico-close.gif",imgpath:"",closeOnEscape:false,labelswidth:"30%"},b.jgrid.view,d||{});return this.each(function(){var u=this;if(!u.grid||!c){return}if(!d.imgpath){d.imgpath=u.p.imgpath}var o=b("table:first",u.grid.bDiv).attr("id"),h={themodal:"viewmod"+o,modalhead:"viewhd"+o,modalcontent:"viewcnt"+o},f=1,w="ViewGrid_"+o,p="ViewTbl_"+o;if(b("#"+h.themodal).html()!=null){b(".modaltext","#"+h.modalhead).html(d.caption);b("#FormError","#"+p).hide();k(c,u);viewModal("#"+h.themodal,{modal:d.modal});i()}else{b(u.p.colModel).each(function(z){f=Math.max(f,this.formoptions?this.formoptions.colpos||0:0)});var t,x=b("<form name='FormPost' id='"+w+"' class='FormGrid'></form>"),j=b("<table id='"+p+"' class='EditTable' cellspacing='0' cellpading='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");b(x).append(j);var s=l(c,u,j,f),v=u.p.imgpath,q="<img id='pData' src='"+v+u.p.previmg+"'/>",r="<img id='nData' src='"+v+u.p.nextimg+"'/>",y="<input id='cData' type='button'  class='EditButton' value='"+d.bClose+"'/>";t=b("<tr id='Act_Buttons'><td class='navButton'>"+q+"&nbsp;"+r+"</td><td colspan='"+(f*2-1)+"'class='EditButton'>"+y+"</td></tr>");t[0].rp=s.length+100;b(j).append(t);if(f>1){var e=[];b.each(b(j)[0].rows,function(z,A){e[z]=A});e.sort(function(A,z){if(A.rp>z.rp){return 1}if(A.rp<z.rp){return -1}return 0});b.each(e,function(z,A){b("tbody",j).append(A)})}createModal(h,x,d,u.grid.hDiv,u.grid.hDiv);if(d.drag){DnRModal("#"+h.themodal,"#"+h.modalhead+" td.modaltext")}viewModal("#"+h.themodal,{modal:d.modal});i();b("#cData","#"+p).click(function(z){hideModal("#"+h.themodal);z.stopPropagation();return false});b("#nData","#"+p).click(function(z){b("#FormError","#"+p).hide();var A=g();A[0]=parseInt(A[0]);if(A[0]!=-1&&A[1][A[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+w),A[1][A[0]])}k(A[1][A[0]+1],u);b(u).setSelection(A[1][A[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+w),A[1][A[0]+1])}m(A[0]+1,A[1].length-1)}i();return false});b("#pData","#"+p).click(function(A){b("#FormError","#"+p).hide();var z=g();if(z[0]!=-1&&z[1][z[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+w),z[1][z[0]])}k(z[1][z[0]-1],u);b(u).setSelection(z[1][z[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+w),z[1][z[0]-1])}m(z[0]-1,z[1].length-1)}i();return false})}function i(){if(d.closeOnEscape===true){setTimeout(function(){b(".jqmClose","#"+h.modalhead).focus()},0)}}var n=g();m(n[0],n[1].length-1);function m(B,C,A){var z=u.p.imgpath;if(B==0){b("#pData","#"+p).attr("src",z+"off-"+u.p.previmg)}else{b("#pData","#"+p).attr("src",z+u.p.previmg)}if(B==C){b("#nData","#"+p).attr("src",z+"off-"+u.p.nextimg)}else{b("#nData","#"+p).attr("src",z+u.p.nextimg)}}function g(){var A=b(u).getDataIDs();var z=b("#id_g","#"+p).val();var B=b.inArray(z,A);return[B,A]}function l(F,L,J,S){var B,E,N,V,z,Q=0,U,W,M,T=[],K=false,H="<td class='CaptionTD' width='"+d.labelswidth+"'>&nbsp;</td><td class='DataTD'>&nbsp;</td>",I="",C="<td class='CaptionTD'>&nbsp;</td><td class='DataTD'>&nbsp;</td>",G=["integer","number","currency"],P=0,O=0,D,A;for(var R=1;R<=S;R++){I+=R==1?H:C}b(L.p.colModel).each(function(Y){if(this.editrules&&this.editrules.edithidden===true){E=false}else{E=this.hidden===true?true:false}if(!E&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,G)!==-1){P=Math.max(P,parseInt(this.width,10))}else{O=Math.max(O,parseInt(this.width,10))}}});D=P!==0?P:O!==0?O:0;K=b(L).getInd(L.rows,F);b(L.p.colModel).each(function(Z){B=this.name;A=false;if(this.editrules&&this.editrules.edithidden===true){E=false}else{E=this.hidden===true?true:false}W=E?"style='display:none'":"";if(B!=="cb"&&B!=="subgrid"&&this.editable===true){if(K===false){U=""}else{if(B==L.p.ExpandColumn&&L.p.treeGrid===true){U=b("td:eq("+Z+")",L.rows[K]).text()}else{U=b("td:eq("+Z+")",L.rows[K]).html()}}A=this.align==="right"&&D!==0?true:false;var Y=b.extend({},this.editoptions||{},{id:B,name:B}),ac=b.extend({},{elmprefix:"",elmsuffix:""},this.formoptions||{}),aa=parseInt(ac.rowpos)||Q+1,ab=parseInt((parseInt(ac.colpos)||1)*2);if(!this.edittype){this.edittype="text"}N=b(j).find("tr[rowpos="+aa+"]");if(N.length==0){N=b("<tr "+W+" rowpos='"+aa+"'></tr>").addClass("FormData").attr("id","tr_"+B);b(N).append(I);b(J).append(N);N[0].rp=aa}b("td:eq("+(ab-2)+")",N[0]).html("<b>"+(typeof ac.label==="undefined"?L.p.colNames[Z]:ac.label)+"</b>");b("td:eq("+(ab-1)+")",N[0]).append("<span style='position:absolute;float:left;'>"+U+"</span>").attr("id",B);if(A){b("td:eq("+(ab-1)+") span",N[0]).css({"text-align":"right",width:D+"px"})}T[Q]=Z;Q++}});if(Q>0){var X=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(S*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+F+"'/></td></tr>");X[0].rp=Q+99;b(J).append(X)}return T}function k(D,E){var z,F,C=0,B,A;b("#"+D+" td",E.grid.bDiv).each(function(G){z=E.p.colModel[G].name;if(E.p.colModel[G].editrules&&E.p.colModel[G].editrules.edithidden===true){F=false}else{F=E.p.colModel[G].hidden===true?true:false}if(z!=="cb"&&z!=="subgrid"&&E.p.colModel[G].editable===true){if(z==E.p.ExpandColumn&&E.p.treeGrid===true){B=b(this).text()}else{B=b(this).html()}z=z.replace(".","\\.");A=b.extend({},E.p.colModel[G].editoptions||{});b("#"+z+" span","#"+p).html(B);if(F){b("#"+z,"#"+p).parents("tr:first").hide()}C++}});if(C>0){b("#id_g","#"+p).val(D)}else{b("#id_g","#"+p).val("")}return C}})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:90,modal:false,drag:true,closeicon:"ico-close.gif",imgpath:"",url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,onclickSubmit:null,closeOnEscape:false,delData:{}},b.jgrid.del,d||{});return this.each(function(){var j=this;if(!j.grid){return}if(!c){return}if(!d.imgpath){d.imgpath=j.p.imgpath}var l=typeof d.beforeShowForm==="function"?true:false,f=typeof d.afterShowForm==="function"?true:false,e=b("table:first",j.grid.bDiv).attr("id"),g={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e},i="DelTbl_"+e,m;if(isArray(c)){c=c.join()}if(b("#"+g.themodal).html()!=null){b("#DelData>td","#"+i).text(c);b("#DelError","#"+i).hide();if(d.processing===true){d.processing=false;b("#dData","#"+i).attr("disabled",false);b("div.loading","#"+g.themodal).hide()}if(l){d.beforeShowForm(b("#"+i))}viewModal("#"+g.themodal,{modal:d.modal});if(f){d.afterShowForm(b("#"+i))}}else{var k=b("<table id='"+i+"' class='DelTable'><tbody></tbody></table>");b(k).append("<tr id='DelError' style='display:none'><td >&nbsp;</td></tr>");b(k).append("<tr id='DelData' style='display:none'><td >"+c+"</td></tr>");b(k).append("<tr><td >"+d.msg+"</td></tr>");var h="<input id='dData' type='button' value='"+d.bSubmit+"'/>";var n="<input id='eData' type='button' value='"+d.bCancel+"'/>";b(k).append("<tr><td class='DelButton'>"+h+"&nbsp;"+n+"</td></tr>");createModal(g,k,d,j.grid.hDiv,j.grid.hDiv);if(d.drag){DnRModal("#"+g.themodal,"#"+g.modalhead+" td.modaltext")}b("#dData","#"+i).click(function(r){var p=[true,""];var q=b("#DelData>td","#"+i).text();if(typeof d.onclickSubmit==="function"){d.delData=d.onclickSubmit(d)||{}}if(typeof d.beforeSubmit==="function"){p=d.beforeSubmit(q)}var o=d.url?d.url:j.p.editurl;if(!o){p[0]=false;p[1]+=" "+b.jgrid.errors.nourl}if(p[0]===false){b("#DelError>td","#"+i).html(p[1]);b("#DelError","#"+i).show()}else{if(!d.processing){d.processing=true;b("div.loading","#"+g.themodal).show();b(this).attr("disabled",true);var s=b.extend({oper:"del",id:q},d.delData);b.ajax({url:o,type:d.mtype,data:s,complete:function(w,u){if(u!="success"){p[0]=false;p[1]=u+" Status: "+w.statusText+" Error code: "+w.status}else{if(typeof d.afterSubmit==="function"){p=d.afterSubmit(w,q)}}if(p[0]===false){b("#DelError>td","#"+i).html(p[1]);b("#DelError","#"+i).show()}else{if(d.reloadAfterSubmit){if(j.p.treeGrid){b(j).setGridParam({treeANode:0,datatype:j.p.treedatatype})}b(j).trigger("reloadGrid")}else{var t=[];t=q.split(",");if(j.p.treeGrid===true){try{b(j).delTreeNode(t[0])}catch(x){}}else{for(var v=0;v<t.length;v++){b(j).delRowData(t[v])}}j.p.selrow=null;j.p.selarrrow=[]}if(b.isFunction(d.afterComplete)){m=w;setTimeout(function(){d.afterComplete(m,q);m=null},500)}}d.processing=false;b("#dData","#"+i).attr("disabled",false);b("div.loading","#"+g.themodal).hide();if(p[0]){hideModal("#"+g.themodal)}},error:function(v,t,u){b("#DelError>td","#"+i).html(t+" : "+u);b("#DelError","#"+i).show();d.processing=false;b("#dData","#"+i).attr("disabled",false);b("div.loading","#"+g.themodal).hide()}})}}return false});b("#eData","#"+i).click(function(o){hideModal("#"+g.themodal);return false});if(l){d.beforeShowForm(b("#"+i))}viewModal("#"+g.themodal,{modal:d.modal});if(f){d.afterShowForm(b("#"+i))}}})},navGrid:function(f,h,e,g,d,c,i){h=b.extend({edit:true,editicon:"row_edit.gif",add:true,addicon:"row_add.gif",del:true,delicon:"row_delete.gif",search:true,searchicon:"find.gif",refresh:true,refreshicon:"refresh.gif",refreshstate:"firstpage",position:"left",closeicon:"ico-close.gif",closeOnEscape:true,view:true,viewicon:"row_view.gif"},b.jgrid.nav,h||{});return this.each(function(){var l={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"};var o=this;if(!o.grid){return}if(b("#"+l.themodal).html()==null){var n;var q;if(typeof window.innerWidth!="undefined"){n=window.innerWidth,q=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){n=document.documentElement.clientWidth,q=document.documentElement.clientHeight}else{n=1024;q=768}}createModal(l,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'><span></span>",{imgpath:o.p.imgpath,closeicon:h.closeicon,caption:h.alertcap,top:q/2-25,left:n/2-100,width:200,height:50,closeOnEscape:h.closeOnEscape},o.grid.hDiv,o.grid.hDiv,true);DnRModal("#"+l.themodal,"#"+l.modalhead)}var r=b("<table cellspacing='0' cellpadding='0' border='0' class='navtable'><tbody></tbody></table>").height(20);var m=document.createElement("tr");b(m).addClass("nav-row");var j=o.p.imgpath;var p;if(h.add){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");p.title=h.addtitle||"";b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td><img src='"+j+h.addicon+"'/></td><td>"+h.addtext+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(){if(typeof h.addfunc=="function"){h.addfunc()}else{b(o).editGridRow("new",g||{})}return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.edit){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");p.title=h.edittitle||"";b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td><img src='"+j+h.editicon+"'/></td><td valign='center'>"+h.edittext+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(){var s=b(o).getGridParam("selrow");if(s){if(typeof h.editfunc=="function"){h.editfunc(s)}else{b(o).editGridRow(s,e||{})}}else{viewModal("#"+l.themodal,{toTop:false});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.view){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");p.title=h.viewtitle||"";b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td><img src='"+j+h.viewicon+"'/></td><td valign='center'>"+h.viewtext+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(){var s=b(o).getGridParam("selrow");if(s){b(o).viewGridRow(s,i||{})}else{viewModal("#"+l.themodal,{toTop:false});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.del){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");p.title=h.deltitle||"";b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td><img src='"+j+h.delicon+"'/></td><td>"+h.deltext+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(){var s;if(o.p.multiselect){s=b(o).getGridParam("selarrrow");if(s.length==0){s=null}}else{s=b(o).getGridParam("selrow")}if(s){b(o).delGridRow(s,d||{})}else{viewModal("#"+l.themodal,{toTop:false});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.search){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");if(b(f)[0]==o.p.pager[0]){c=b.extend(c,{dirty:true})}p.title=h.searchtitle||"";b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td class='no-dirty-cell'><img src='"+j+h.searchicon+"'/></td><td>"+h.searchtext+"&nbsp;</td></tr></table>").css({cursor:"pointer"}).addClass("nav-button").click(function(){b(o).searchGrid(c||{});return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.refresh){p=document.createElement("td");b(p).append("&nbsp;").css({border:"none",padding:"0px"});m.appendChild(p);p=document.createElement("td");p.title=h.refreshtitle||"";var k=(b(f)[0]==o.p.pager[0])?true:false;b(p).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td><img src='"+j+h.refreshicon+"'/></td><td>"+h.refreshtext+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(){o.p.search=false;switch(h.refreshstate){case"firstpage":o.p.page=1;b(o).trigger("reloadGrid");break;case"current":var s=o.p.multiselect===true?selarrrow:o.p.selrow;b(o).setGridParam({gridComplete:function(){if(o.p.multiselect===true){if(s.length>0){for(var u=0;u<s.length;u++){b(o).setSelection(s[u])}}}else{if(s){b(o).setSelection(s)}}}});b(o).trigger("reloadGrid");break}if(k){b(".no-dirty-cell",o.p.pager).removeClass("dirty-cell")}if(h.search){var t=b("table:first",o.grid.bDiv).attr("id");b("#sval","#srchcnt"+t).val("")}return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});m.appendChild(p);p=null}if(h.position=="left"){b(r).append(m).addClass("nav-table-left")}else{b(r).append(m).addClass("nav-table-right")}b(f).prepend(r)})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonimg:"",onClickButton:null,position:"last"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!=0){c="#"+c}var i=b(".navtable",c)[0];if(i){var e,h;var h=document.createElement("td");b(h).append("&nbsp;").css({border:"none",padding:"0px"});var g=b("tr:eq(0)",i)[0];if(d.position!="first"){g.appendChild(h)}tbd=document.createElement("td");tbd.title=d.title;var f=(d.buttonimg)?"<img src='"+d.buttonimg+"'/>":"&nbsp;";b(tbd).append("<table cellspacing='0' cellpadding='0' border='0' class='tbutton'><tr><td>"+f+"</td><td>"+d.caption+"&nbsp;</td></tr></table>").css("cursor","pointer").addClass("nav-button").click(function(j){if(typeof d.onClickButton=="function"){d.onClickButton()}j.stopPropagation();return false}).hover(function(){b(this).addClass("nav-hover")},function(){b(this).removeClass("nav-hover")});if(d.position!="first"){g.appendChild(tbd)}else{b(g).prepend(tbd);b(g).prepend(h)}tbd=null;h=null}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).getRowData(c);if(f){for(var e in f){if(b("[name="+e+"]",d).is("input:radio")){b("[name="+e+"]",d).each(function(){if(b(this).val()==f[e]){b(this).attr("checked","checked")}else{b(this).attr("checked","")}})}else{b("[name="+e+"]",d).val(f[e])}}}})},FormToGrid:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var e=b(d).serializeArray();var f={};b.each(e,function(h,j){f[j.name]=j.value});b(g).setRowData(c,f)})}})})(jQuery);
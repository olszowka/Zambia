TITLE='Interest v Schedule - sorted by pubsname'
DESCRIPTION='Show who is interested in each panel and if they are assigned to it.  Also show the scheduling information (sorted by pubsname)'
PROGWANTS=1
QUERY="
select 
       concat(X.pubsname, '(', X.badgeid, ')') as Pubsname,
       X.trackname, 
       concat('<a href=StaffAssignParticipants.php?selsess=',X.sessionid,'>', X.sessionid,'</a>') as Sessionid,
       concat('<a href=EditSession.php?id=',X.sessionid,'>',X.title,'</a>') Title,
       X.rank as Rank,
       (if (X.assigned is NULL,' ','yes')) as 'Asgn?', 
       (if (moderator is NULL or moderator=0,' ','yes')) as 'Mod?', 
       concat('<a href=MaintainRoomSched.php?selroom=',Y.roomid,'>', Y.roomname,'</a>') as Roomname,
       DATE_FORMAT(ADDTIME('2010-01-15 00:00:00',Y.starttime),'%a %l:%i %p') as 'Start Time' 
  from (    select PI.badgeid, PI.pubsname, PI.sessionid, POS.sessionid as assigned, moderator, title, trackname, rank
             from (    select T.trackname, S.title, S.sessionid, P.badgeid, P.pubsname, PSI.rank
                          from Tracks T, ParticipantSessionInterest PSI, 
                               Participants P, Sessions S
                         where S.trackid=T.trackid and P.interested=1 
                           and P.badgeid=PSI.badgeid and S.sessionid=PSI.sessionid ) PI 
                   left join ParticipantOnSession POS 
                          on POS.badgeid=PI.badgeid and POS.sessionid=PI.sessionid) X 
                   left join (select SCH.starttime, R.roomname, R.roomid, SCH.sessionid 
                                from Schedule SCH, Rooms R 
                               where R.roomid=SCH.roomid) as Y 
                          on X.sessionid=Y.sessionid 
          order by substring_index(pubsname,' ',-1),
	  	   pubsname;"


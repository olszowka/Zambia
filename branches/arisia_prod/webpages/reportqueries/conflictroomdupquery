TITLE='Conflict Report - Room Schedule Overlaps'
DESCRIPTION='Find any pairs of sessions whose times overlap in the same room.'
CONFLICTWANTS=1
QUERY="Select concat('<a href=MaintainRoomSched.php?selroom=',R.roomid,'>', R.roomname,'</a>') as Roomname, SA.title as 'Title A', Asess as 'Sessionid A', DATE_FORMAT(ADDTIME('2011-01-14 00:00:00',Astart),'%a %l:%i %p') as 'Start Time A', DATE_FORMAT(ADDTIME('2011-01-14 00:00:00',Aend),'%a %l:%i %p') as 'End Time A', SB.title as 'Title B', Bsess as 'Sessionid B', DATE_FORMAT(ADDTIME('2011-01-14 00:00:00',Bstart),'%a %l:%i %p') as 'Start Time B', DATE_FORMAT(ADDTIME('2011-01-14 00:00:00',Bend),'%a %l:%i %p') as 'End Time B' from Sessions SA, Sessions SB, Rooms R, (select A.roomid, A.sessionid as Asess, A.starttime as Astart, ADDTIME(A.starttime, SA.duration) as Aend, B.sessionid as Bsess, B.starttime as Bstart, ADDTIME(B.starttime, SB.duration) as Bend from Schedule A, Schedule B, Sessions SA, Sessions SB where A.roomid = B.roomid and A.starttime<=B.starttime and ADDTIME(A.starttime, SA.duration)>B.starttime and A.sessionid<>B.sessionid and A.sessionid=SA.sessionid and B.sessionid=SB.sessionid) as Foo where Foo.roomid = R.roomid and Foo.Asess=SA.sessionid and Foo.Bsess=SB.sessionid;"

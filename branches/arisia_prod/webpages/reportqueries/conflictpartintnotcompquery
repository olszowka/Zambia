TITLE='Conflict Report - Interested Participants that wont comp '
DESCRIPTION='Comps are limited to participants on 3 or more sessions.  These folks are on less than 3 scheduled sessions.'
CONFLICTWANTS=1
REGWANTS=1
QUERY="
  select P.badgeid, 
         P.pubsname,
         CONCAT('<a href=\"mailto:',C.email,'\">',C.email,'</a>') as email, 
         if (X.Schd is NULL, 0, X.Schd) Schd, 
         if (Y.Intr is NULL, 0, Y.Intr) Intr
    from CongoDump C, 
         Participants P 
         left join (   select POS.badgeid, 
                              count(POS.sessionid) Schd
                         from ParticipantOnSession POS,
                              Schedule S
                        where S.sessionid=POS.sessionid
                     group by POS.badgeid) X
                on P.badgeid=X.badgeid 
         left join (  select PSI.badgeid, 
                             count(PSI.sessionid) as Intr
                        from ParticipantSessionInterest PSI
                    group by PSI.badgeid) Y
                on Y.badgeid=P.badgeid
   where C.badgeid=P.badgeid 
     and interested=1 
     and C.regtype is NULL 
  having Schd < 3
order by Intr desc, cast(C.badgeid as unsigned);"

TITLE='Session Edit History Report '
DESCRIPTION='Show the most recent edit activity for each session (sorted by time).'
PROGWANTS=1
EVENTSWANTS=1
QUERY='
    SELECT SEH2.timestamp as "When",
           concat("<a href=StaffAssignParticipants.php?selsess=",S.sessionid,">",
                 S.sessionid,"</a>") as Sessionid,
           T.trackname as "Track", 
           concat("<a href=EditSession.php?id=",S.sessionid,">",S.title,"</a>") Title,
           SS.statusname as "Current<BR>Status", 
           concat(SEH1.name," (",SEH1.email_address,")") as "Who", 
           SEC.description as "What",
           ifnull(SEH1.editdescription,"&nbsp;") as "Notes"
      from Sessions S, 
           Tracks T, 
           SessionStatuses SS, 
           SessionEditHistory SEH1, 
           SessionEditCodes SEC, 
           (Select SEH3.sessionid, 
                   Max(SEH3.timestamp) as timestamp 
              from SessionEditHistory SEH3 
          group by SEH3.sessionid) SEH2 
    where S.trackid=T.trackid 
      and S.sessionid = SEH1.sessionid 
      and S.sessionid = SEH2.sessionid 
      and SEH1.timestamp = SEH2.timestamp 
      and SEH1.statusid = SS.statusid 
      and SEH1.sessioneditcode = SEC.sessioneditcode 
      and S.statusid >= 1 
      and S.statusid <= 7 
 order by SEH2.timestamp Desc;'

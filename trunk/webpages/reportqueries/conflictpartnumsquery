TITLE='Conflict Report - Participant Number of Sessions'
DESCRIPTION='Compare number of sessions participants requested with the number of which they were assigned'
CONFLICTWANTS=1
REGWANTS=1
QUERY="
 select PA.badgeid, 
        P.pubsname, 
        if ((fridaymaxprog is NULL), '<div style=background:lightgray\;>-</div>',concat('<div style=background:lightgray\;>',fridaymaxprog,'</div>')) as 'Fri Reqd.', 
        frisched as 'Fri Asgnd.', 
        if ((saturdaymaxprog is NULL), '<div style=background:lightgray\;>-</div>',concat('<div style=background:lightgray\;>',saturdaymaxprog,'</div>')) as 'Sat Reqd.', 
        satsched as 'Sat Asgnd.', 
        if ((sundaymaxprog is NULL), '<div style=background:lightgray\;>-</div>',concat('<div style=background:lightgray\;>',sundaymaxprog,'</div>')) as 'Sun Reqd.', 
        sunsched as 'Sun Asgnd.',
        if ((mondaymaxprog is NULL), '<div style=background:lightgray\;>-</div>',concat('<div style=background:lightgray\;>',mondaymaxprog,'</div>')) as 'Mon Reqd.', 
        monsched as 'Mon Asgnd.',
        concat('<div style=background:lightgray\;>',maxprog,'</div>') as 'Total Reqd.', 
        totsched as 'Total Asgnd.' 
   from ParticipantAvailability PA,  
        Participants P 
        left join (  select badgeid, 
                            sum(if(starttime<'24:00:00',1,0)) as frisched, 
                            sum(if((starttime>='24:00:00' 
                                 && starttime<='48:00:00'),1,0)) as satsched, 
                            sum(if((starttime>='48:00:00'
                                 && starttime<='72:00:00'),1,0)) as sunsched, 
                            sum(if(starttime>='72:00:00',1,0)) as monsched, 
                            count(*) as totsched 
                       from (select POS.badgeid, 
                                    POS.sessionid, 
                                    SCH.starttime 
                               from ParticipantOnSession POS, 
                                    Schedule SCH 
                              where POS.sessionid=SCH.sessionid) as FOO  
                    group by badgeid) as BAR 
                on P.badgeid=BAR.badgeid 
   where PA.badgeid = P.badgeid 
      and P.interested=1 
order by cast(PA.badgeid as unsigned);"
